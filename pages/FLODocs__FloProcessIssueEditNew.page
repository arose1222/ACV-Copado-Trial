<apex:page showHeader="true" sidebar="false" standardController="FLODocs__FLO_Process_Issue__c" extensions="FLODocs.FloProcessIssueEditNewController">
  <c:StrongpointAnalytics />
    <apex:form >
      <apex:actionFunction name="savePIAF" action="{!save}"/>
      <apex:actionFunction name="cancelPIAF" action="{!cancel}"/>

      <apex:outputPanel rendered="{! $User.UIThemeDisplayed == 'Theme312312' }">
        <apex:sectionHeader title="Process Issue" subtitle="New/Edit Process Issue"/>
        <apex:pageMessages />
        <apex:pageBlock title="Process Issue Info">
          <apex:pageBlockButtons >
            <apex:commandButton action="{!save}" value="Save" reRender="" />
            <apex:commandButton action="{!cancel}" value="Cancel" />
          </apex:pageBlockButtons>
          <apex:pageBlockSection title="Information" collapsible="false" columns="2">
                <apex:inputField required="true" value="{!processIssue.Name}" />
                <apex:inputField required="true" value="{!processIssue.FLODocs__Type__c}" />
                <apex:inputField value="{!processIssue.FLODocs__Issue_Description__c}" />
                <apex:inputField value="{!processIssue.FLODocs__Process__c}" />
                <apex:inputField value="{!processIssue.FLODocs__Status__c}" />
                <apex:inputField value="{!processIssue.FLODocs__Parent_Issue__c}" />
                <apex:inputField value="{!processIssue.FLODocs__Approval_Status__c}" />
                <apex:inputField value="{!processIssue.FLODocs__Severity__c}" />
                <apex:inputField value="{!processIssue.FLODocs__Approver__c}" />
                <apex:inputField value="{!processIssue.FLODocs__External_Ticket_Link__c}" />
                <apex:inputField value="{!processIssue.FLODocs__External_Ticket_Number__c}" />
          </apex:pageBlockSection>
          <apex:pageBlockSection title="Customizations" collapsible="false" columns="2">
            <c:FloMultiSelectList leftLabel="Select Customization" isCustomization="true" leftOption="{!listCustomizationsOptions}" rightLabel="Selected Customization(s)" rightOption="{!selectedCustomization}" size="7" width="400px"/>
          </apex:pageBlockSection>
          <apex:pageBlockSection title="Implementation" collapsible="false" columns="2" id="scopePb">
            <apex:inputField value="{!processIssue.FLODocs__Target_Resolution_Date__c}" />
            <apex:inputField value="{!processIssue.FLODocs__Assigned__c}" />
        <apex:inputfield value="{!processIssue.FLODocs__Request_Process_Help__c}"/>
        <apex:inputfield value="{!processIssue.FLODocs__Related_Test__c}"/>
        <apex:inputfield value="{!processIssue.Effort_Required__c  }"/>
        <apex:inputfield value="{!processIssue.FLODocs__Originating_URL__c}"/>
        <apex:inputfield value="{!processIssue.FLODocs__Test__c}"/>
          </apex:pageBlockSection>
        </apex:pageBlock>
      </apex:outputPanel>

      <!-- <apex:outputPanel rendered="{! $User.UIThemeDisplayed == 'Theme4d' }" > -->
      <apex:outputPanel >
          <apex:stylesheet value="{!URLFOR($Resource.FLODocs__SLDS22, 'assets/styles/salesforce-lightning-design-system.css')}" />
          <apex:includeScript value="{!URLFOR($Resource.FLODocs__FLOJQuery, '/jquery-ui-1.12.1.custom/external/jquery/jquery.js')}"  />
          <script>

            function savePI(){
              savePIAF();
            }

            function cancelPI(){
              cancelPIAF();
            }
            function modalCustoJs(){
              $('#ModalCustomization').toggle();
              drawCardTable('custo');
            }
            function drawCardTable(cardId){
              $('#'+cardId).find('tbody').find('tr').remove();
              var rightSectionId = '';
              var counterId = '';
              var counterName = '';
              if(cardId == 'custo'){
                rightSectionId = 'rightListSelected Customization(s)';
                counterIdName = 'custoCount';
                counterName = 'Customizations';
              }
              var options = document.getElementById(rightSectionId).getElementsByTagName('option');
              var htmlTr = '';
              var counterQuantity = 0;
              if(options != null){
                counterQuantity = options.length;
                for(var i = 0 ; i < options.length ; i++){
                   htmlTr += '<tr class="slds-hint-parent">';
                   htmlTr += '<th scope="row">';
                   htmlTr += '<div class="slds-truncate" title="'+options[i].innerHTML+'"><a href="/'+options[i].value+'">'+options[i].innerHTML+'</a></div>';
                   htmlTr += '</th>';
                   htmlTr += '</tr>';
                }
              }
              $('#'+cardId).find('tbody').append(htmlTr);
              $('#'+counterIdName).html(counterName+ ' ' + '('+counterQuantity+')');
            }
          </script>
          <div class="slds">
                <div class="slds-page-header">
                  <div class="slds-grid">
                    <div class="slds-col slds-has-flexi-truncate">
                      <div class="slds-media slds-no-space slds-grow">
                        <div class="slds-media__figure">
                           <img src="{!$Resource.FLO_Logo}" style="max-width: 80px;"/>
                        </div>
                        <div class="slds-media__body">
                          <p class="slds-text-title--caps slds-line-height--reset">New Process Issue</p>
                          <h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate" title="this should match the Record Title">Create/Edit Process Issue</h1>
                          <div style="float: right;margin-top: -10px;">
                            <button type="button" class="slds-button slds-button--neutral" onclick="cancelPI();">Cancel</button>
                            <button type="button" class="slds-button slds-button--brand" onclick="savePI();">Save</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <fieldset class="slds-form--compound">
                  <div class="slds-section  slds-section__title-action">
                    <h3 class="slds-section__title  ">Information</h3>
                  </div>
                  <div class="slds-form-element__group">
                    <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">Process Issue Name</label>
                        <apex:inputfield value="{!processIssue.Name}" styleClass="slds-input"/>
                      </div>
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-02">Change Type</label>
                          <div class="slds-select_container" >
                              <apex:selectList size="1" value="{!processIssue.FLODocs__Type__c}" styleClass="slds-select">
                                  <apex:selectOptions value="{!typePicklist}" />
                              </apex:selectList>
                          </div>
                      </div>
                    </div>
                    <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">Issue Description</label>
                        <apex:inputTextarea value="{!processIssue.FLODocs__Issue_Description__c}" styleClass="slds-input" />
                      </div>
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-02">Process</label>
                        <apex:inputField value="{!processIssue.FLODocs__Process__c}" styleClass="slds-input" />
                      </div>
                    </div>
                    <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">Status</label>
                          <div class="slds-select_container" >
                            <apex:selectList size="1" value="{!processIssue.FLODocs__Status__c}" styleClass="slds-select">
                                <apex:selectOptions value="{!statusList}" />
                            </apex:selectList>
                          </div>
                      </div>
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-02">Approver</label>
                        <apex:inputField value="{!processIssue.FLODocs__Approver__c}" styleClass="slds-input"/>
                      </div>
                    </div>
                    <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">External Ticket Number</label>
                          <div class="slds-select_container" >
                             <apex:inputField value="{!processIssue.FLODocs__External_Ticket_Number__c}" styleClass="slds-input"/>
                          </div>
                      </div>
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-02">External Ticket Link</label>
                        <apex:inputField value="{!processIssue.FLODocs__External_Ticket_Link__c}" styleClass="slds-input"/>
                      </div>
                    </div>

                    <div class="slds-form-element__row">
                       <div class="slds-form-element slds-size--1-of-2">
                          <article class="slds-card">
                              <div class="slds-card__header slds-grid">
                                <header class="slds-media slds-media--center slds-has-flexi-truncate">
                                  <div class="slds-media__figure">
                                    <span class="slds-icon_container slds-icon-standard-contact" title="description of icon when needed">
                                     
                                    </span>
                                  </div>
                                  <div class="slds-media__body">
                                    <h2>
                                      <a href="javascript:void(0);" class="slds-card__header-link slds-truncate">
                                        <span id="custoCount" class="slds-text-heading--small">Customizations ({!selectedCustomization.size})</span>
                                      </a>
                                    </h2>
                                  </div>
                                </header>
                                <div class="slds-no-flex">
                                  <button type="button" class="slds-button slds-button--brand" onclick="modalCustoJs();" >Add</button>
                                </div>
                              </div>
                              <div class="slds-card__body" style="height: 120px;overflow:auto;">
                                <table id="custo" class="slds-table slds-table--bordered slds-no-row-hover slds-table--cell-buffer">
                                  <thead>
                                    <tr class="slds-text-title--caps">
                                      <th scope="col">
                                        <div class="slds-truncate" title="Name">Name</div>
                                      </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                      <apex:repeat value="{!selectedCustomization}" var="c">
                                        <tr class="slds-hint-parent">
                                          <th scope="row">
                                            <div class="slds-truncate" title="{!c.Label}"><a href="/{!c.Value}">{!c.Label}</a></div>
                                          </th>
                                        </tr>
                                      </apex:repeat>
                                  </tbody>
                                </table>
                              </div>
                              <div class="slds-card__footer"><a href="javascript:void(0);" onclick="modalCustoJs();">View All</a></div>
                           </article>
                       </div>
                    </div>

                    
                     
                  </div>
                </fieldset>

                <fieldset class="slds-form--compound">
                  <div class="slds-section  slds-section__title-action">
                    <h3 class="slds-section__title  ">Implementation</h3>
                  </div>
                  <div class="slds-form-element__group">
                    <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">Target Resolution Date</label>
                        <apex:inputField value="{!processIssue.FLODocs__Target_Resolution_Date__c}" styleClass="slds-input"/>
                      </div>
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-02">Assigned</label>
                         <apex:inputField value="{!processIssue.FLODocs__Assigned__c}" styleClass="slds-input" />
                      </div>
                    </div>
                    <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">Request Process Help</label>
                        <apex:inputField value="{!processIssue.FLODocs__Request_Process_Help__c}" styleClass="slds-input"/>
                      </div>
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-02">Related Test</label>
                        <apex:inputField value="{!processIssue.FLODocs__Related_Test__c}" styleClass="slds-input"/>
                      </div>
                    </div>
                      <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">Effort Required</label>
                        <apex:inputField value="{!processIssue.FLODocs__Effort_Required__c}" styleClass="slds-input"/>   
                      </div>
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-02">Originating URL</label>
                        <apex:inputField value="{!processIssue.FLODocs__Originating_URL__c}" styleClass="slds-input"/>
                      </div>
                    </div>
                     <div class="slds-form-element__row">
                      <div class="slds-form-element slds-size--1-of-2">
                        <label class="slds-form-element__label" for="input-01">Test</label>
                        <apex:inputField value="{!processIssue.FLODocs__Test__c}" styleClass="slds-input"/>
                      </div>
                    </div>
                  </div>
                </fieldset>
                <br/>
                <br/>
                <br/>

                <div id="ModalCustomization" style="display:none;" >
                  <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open">
                      <div class="slds-modal__container">
                        <div class="slds-modal__header">
                          <button class="slds-button slds-modal__close slds-button--icon-inverse" title="Close">
                            <span class="slds-assistive-text">Close</span>
                          </button>
                          <h2 id="header43" class="slds-text-heading--medium">Add Customizations</h2>
                          <p class="slds-m-top--x-small">Select customizations to be added into the Change Request.</p>
                        </div>
                        <div class="slds-modal__content slds-p-around--medium">
                          <c:FloMultiSelectList id="multi2" leftLabel="Select Customization" leftOption="{!listCustomizationsOptions}" rightLabel="Selected Customization(s)" rightOption="{!selectedCustomization}" size="7" width="250px" isCustomization="true"/>
                        </div>
                        <div class="slds-modal__footer">
                          <button class="slds-button slds-button--neutral" onclick="modalCustoJs(); return false;">Save</button>
                        </div>
                      </div>
                  </div>
                  <div class="slds-backdrop slds-backdrop--open"></div>
                </div>

                 <div class="slds-docked-form-footer">
                    <button class="slds-button slds-button--icon slds-button--icon-error" title="Review the Following Errors">
                      <span class="slds-assistive-text">Settings</span>
                    </button>
                    <button type="button" class="slds-button slds-button--neutral" onclick="cancelPI();">Cancel</button>
                    <button type="button" class="slds-button slds-button--brand" onclick="savePI();">Save</button>
                  </div>
          </div>
      </apex:outputPanel>
  </apex:form>
</apex:page>